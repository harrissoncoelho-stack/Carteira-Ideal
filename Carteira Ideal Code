<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora de Investimentos</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f6f9;
      color: #333;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .calculator {
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      max-width: 600px;
      width: 100%;
    }
    .calculator h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #0066cc;
    }
    label {
      font-size: 14px;
      margin-top: 10px;
      display: block;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      margin-top: 20px;
      padding: 12px;
      width: 100%;
      background: #0066cc;
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background: #004999;
    }
    .result {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      background: #e9f5ff;
      border: 1px solid #b3e0ff;
    }
    .result p {
      margin: 8px 0;
      font-weight: bold;
    }
    canvas {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="calculator">
    <h2>Simulador de Investimentos</h2>

    <label>Tipo de investimento</label>
    <select id="tipoInvestimento">
      <option value="cdb">CDB (% do CDI)</option>
      <option value="lci">LCI/LCA (isento IR)</option>
      <option value="ipca">IPCA + Taxa</option>
      <option value="prefixado">PrÃ©-fixado</option>
    </select>

    <label>Valor inicial (R$)</label>
    <input type="number" id="valorInicial" placeholder="Ex: 1000">

    <label>Aporte mensal (R$)</label>
    <input type="number" id="aporteMensal" placeholder="Ex: 200">

    <label>Taxa (% ao ano)</label>
    <input type="number" id="taxaJuros" placeholder="Ex: 12">

    <label>InflaÃ§Ã£o (IPCA % ao ano) [se aplicÃ¡vel]</label>
    <input type="number" id="ipca" placeholder="Ex: 4">

    <label>Prazo (anos)</label>
    <input type="number" id="prazo" placeholder="Ex: 5">

    <button onclick="calcular()">Calcular</button>

    <div class="result" id="resultado" style="display:none;"></div>
    <canvas id="graficoEvolucao" style="display:none;"></canvas>
  </div>

  <script>
    let chart;

    function calcularIR(meses, rendimento) {
      if (meses <= 6) return rendimento * 0.225;
      if (meses <= 12) return rendimento * 0.20;
      if (meses <= 24) return rendimento * 0.175;
      return rendimento * 0.15;
    }

    function calcular() {
      const tipo = document.getElementById("tipoInvestimento").value;
      const valorInicial = parseFloat(document.getElementById("valorInicial").value) || 0;
      const aporteMensal = parseFloat(document.getElementById("aporteMensal").value) || 0;
      const taxaJuros = parseFloat(document.getElementById("taxaJuros").value) / 100 || 0;
      const ipca = parseFloat(document.getElementById("ipca").value) / 100 || 0;
      const prazo = parseInt(document.getElementById("prazo").value) || 0;

      let montante = valorInicial;
      const meses = prazo * 12;
      let taxaMensal;

      if (tipo === "cdb") {
        const cdi = 0.12;
        const taxaAnual = cdi * (taxaJuros || 1);
        taxaMensal = Math.pow(1 + taxaAnual, 1/12) - 1;
      } else if (tipo === "ipca") {
        const taxaAnual = ipca + taxaJuros;
        taxaMensal = Math.pow(1 + taxaAnual, 1/12) - 1;
      } else {
        taxaMensal = Math.pow(1 + taxaJuros, 1/12) - 1;
      }

      let historicoMontante = [];
      let historicoInvestido = [];

      for (let i = 1; i <= meses; i++) {
        montante = montante * (1 + taxaMensal) + aporteMensal;
        if (i % 12 === 0) {
          historicoMontante.push(montante);
          historicoInvestido.push(valorInicial + aporteMensal * i);
        }
      }

      const totalInvestido = valorInicial + aporteMensal * meses;
      let rendimento = montante - totalInvestido;
      let imposto = 0;

      if (tipo !== "lci") {
        imposto = calcularIR(meses, rendimento);
      }

      const montanteLiquido = montante - imposto;

      document.getElementById("resultado").style.display = "block";
      document.getElementById("resultado").innerHTML = `
        <p>ðŸ’° Valor Bruto: R$ ${montante.toFixed(2)}</p>
        <p>ðŸ“Œ Total Investido: R$ ${totalInvestido.toFixed(2)}</p>
        <p>ðŸ“ˆ Juros Ganhos: R$ ${rendimento.toFixed(2)}</p>
        <p>ðŸ’µ Imposto: R$ ${imposto.toFixed(2)}</p>
        <p>âœ… Valor LÃ­quido: R$ ${montanteLiquido.toFixed(2)}</p>
      `;

      // GrÃ¡fico anual
      const ctx = document.getElementById("graficoEvolucao").getContext("2d");
      document.getElementById("graficoEvolucao").style.display = "block";

      if (chart) chart.destroy();

      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: historicoMontante.map((_, i) => ${i+1}Âº ano),
          datasets: [
            {
              label: 'EvoluÃ§Ã£o do Investimento',
              data: historicoMontante,
              borderColor: '#0066cc',
              backgroundColor: 'rgba(0,102,204,0.1)',
              fill: true,
              tension: 0.2
            },
            {
              label: 'Total Investido',
              data: historicoInvestido,
              borderColor: '#ff6600',
              backgroundColor: 'rgba(255,102,0,0.1)',
              fill: false,
              borderDash: [5,5],
              tension: 0.2
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: true },
          },
          scales: {
            y: {
              ticks: {
                callback: function(value) {
                  return 'R$ ' + value.toLocaleString('pt-BR');
                }
              }
            }
          }
        }
      });
    }
  </script>
</body>
</html>
